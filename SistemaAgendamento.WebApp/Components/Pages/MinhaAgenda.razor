@page "/minha-agenda"
@layout MainLayout
@rendermode InteractiveServer

@using System.Globalization
@using System.Linq
@using SistemaAgendamento.Application.DTOs.Responses
@using System

<div class="container-fluid">

    <div class="row mb-4 align-items-center">
        <div class="col-md-6">
            <h3>Agenda de @UserName</h3>
            <p class="text-muted">Todos os seus compromissos e reservas de sala.</p>
        </div>

        <div class="col-md-6 text-end">
            <label class="form-label mb-0">Visualizar Mês/Dia:</label>
            <input type="month" class="form-control d-inline-block w-auto" @bind="DataFiltro" @bind:after="OnInitializedAsync" />
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
            <span>Compromissos Agendados para @DataFiltro.ToString("MMMM/yyyy", new CultureInfo("pt-BR"))</span>
        </div>
        <div class="card-body">

            @if (!MeusAgendamentos.Any())
            {
                <div class="alert alert-info text-center py-4">
                    <i class="fa fa-calendar-check fa-2x"></i>
                    <p class="mt-2 mb-0">Você não tem agendamentos para o período selecionado.</p>
                </div>
            }
            else
            {
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Data/Hora</th>
                            <th>Local (Sala)</th>
                            <th>Assunto</th>
                            <th>Responsável</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var compromisso in MeusAgendamentos.OrderBy(a => a.DataHoraInicio))
                        {
                            <tr>
                                <td>
                                    @compromisso.DataHoraInicio.ToString("dd/MM/yyyy") <br />
                                    <small class="text-muted">@compromisso.DataHoraInicio.ToString("HH:mm") - @compromisso.DataHoraFim.ToString("HH:mm")</small>
                                </td>
                                <td>
                                    <strong>@compromisso.SalaNome</strong>
                                </td>
                                <td>@compromisso.Titulo</td>
                                <td>@compromisso.ResponsavelNome</td>
                                <td>
                                    <button class="btn btn-sm btn-outline-primary"><i class="fa fa-pencil-alt"></i></button>
                                    <button class="btn btn-sm btn-outline-danger"><i class="fa fa-times"></i></button>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
        </div>
    </div>
</div>